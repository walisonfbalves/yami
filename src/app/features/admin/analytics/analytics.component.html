<div id="analytics-report" class="p-8 space-y-8 bg-stone-950 min-h-screen font-display">

    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
            <h2 class="text-4xl font-heading font-bold text-white tracking-tight uppercase">Análises & Relatórios</h2>
            <p class="text-gray-500 mt-1 font-medium">Visão detalhada de performance e operações</p>
        </div>
        <div class="flex items-center gap-3">

             <div class="flex items-center bg-stone-900 border border-stone-800 rounded-lg p-1" data-html2canvas-ignore="true">
                <ui-button 
                    variant="ghost" 
                    size="sm" 
                    [class.bg-white_10]="selectedPeriod === '7d'" 
                    (click)="loadData('7d')">
                    7 Dias
                </ui-button>
                <ui-button 
                    variant="ghost" 
                    size="sm" 
                    [class.bg-white_10]="selectedPeriod === '30d'" 
                    (click)="loadData('30d')">
                    30 Dias
                </ui-button>
                <ui-button 
                    variant="ghost" 
                    size="sm" 
                    [class.bg-white_10]="selectedPeriod === 'month'" 
                    (click)="loadData('month')">
                    Este Mês
                </ui-button>
            </div>

            <ui-button 
                variant="primary" 
                icon="table_view" 
                (click)="downloadExcel()" 
                data-html2canvas-ignore="true">
                BAIXAR RELATÓRIO EXCEL
            </ui-button>
        </div>
    </div>

    <div *ngIf="isLoading" class="flex justify-center items-center h-64">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-500"></div>
    </div>

    <div *ngIf="error" class="bg-red-500/10 border border-red-500/20 p-4 rounded-lg text-red-500 text-center">
        {{ error }}
        <button (click)="loadData(selectedPeriod)" class="ml-4 underline font-bold">Tentar novamente</button>
    </div>

    <ng-container *ngIf="!isLoading && analyticsData">

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

            <ui-metric-card
                title="Faturamento Total"
                [value]="analyticsData.totalRevenue | currency:'BRL'"
                icon="payments"
                trend="12.5%"
                variant="finance">
                <span class="text-emerald-500 font-bold">+R$ 1.250</span> vs. anterior
            </ui-metric-card>

             <ui-metric-card
                title="Total de Pedidos"
                [value]="analyticsData.totalOrders.toString()"
                icon="shopping_bag"
                trend="5.2%"
                variant="orders">
                <span class="text-emerald-500 font-bold">+12</span> vs. anterior
            </ui-metric-card>

             <ui-metric-card
                title="Ticket Médio"
                [value]="analyticsData.avgTicket | currency:'BRL'"
                icon="receipt_long"
                trend="0%"
                variant="finance">
                 <span class="text-gray-400 font-bold">Estável</span> vs. anterior
            </ui-metric-card>

            <ui-metric-card
                title="Novos Clientes"
                [value]="analyticsData.customerGrowth.total.toString()"
                icon="group_add"
                [trend]="analyticsData.customerGrowth.percentage + '%'"
                variant="people">
                 <span class="text-emerald-500 font-bold">+{{ analyticsData.customerGrowth.percentage }}%</span> mês atual
            </ui-metric-card>
        </div>


        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <ui-card className="lg:col-span-2 flex flex-col min-h-[400px]">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h4 class="text-xl font-heading font-bold text-white uppercase">Histórico de Receita</h4>
                        <p class="text-sm text-gray-500 font-medium">Evolução diária no período</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-amber-500"></span>
                        <span class="text-xs font-medium text-gray-400 uppercase tracking-wider">Receita</span>
                    </div>
                </div>
                <div class="flex-1 relative w-full h-full">
                     <canvas baseChart
                        [data]="barChartData"
                        [options]="barChartOptions"
                        [type]="'bar'">
                    </canvas>
                </div>
            </ui-card>

            <ui-card className="flex flex-col min-h-[400px]">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h4 class="text-xl font-heading font-bold text-white uppercase">Categorias</h4>
                        <p class="text-sm text-gray-500 font-medium">% de Vendas</p>
                    </div>
                </div>
                <div class="flex-1 relative w-full h-full flex items-center justify-center">
                    <canvas baseChart
                        [data]="categoryChartData"
                        [options]="categoryChartOptions"
                        [type]="'doughnut'">
                    </canvas>
                </div>
            </ui-card>
        </div>


        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

             <ui-metric-card
                title="Tempo Médio de Preparo"
                [value]="analyticsData.prepTime.current + ' ' + analyticsData.prepTime.unit"
                icon="timer"
                [trend]="analyticsData.prepTime.current <= analyticsData.prepTime.target ? 'Dentro da Meta' : 'Atenção'"
                variant="performance">
                 <span class="text-gray-400">Meta:</span> <strong class="text-white">{{ analyticsData.prepTime.target }} {{ analyticsData.prepTime.unit }}</strong>
            </ui-metric-card>

             <ui-metric-card
                title="Satisfação do Cliente"
                [value]="analyticsData.customerSatisfaction.score.toString()"
                icon="sentiment_satisfied"
                trend="Excelente"
                variant="finance">
                 <div class="flex items-center gap-1 text-xs text-amber-500">
                     <span class="material-symbols-outlined text-[16px]">star</span>
                     <span class="material-symbols-outlined text-[16px]">star</span>
                     <span class="material-symbols-outlined text-[16px]">star</span>
                     <span class="material-symbols-outlined text-[16px]">star</span>
                     <span class="material-symbols-outlined text-[16px]">star_half</span>
                </div>
            </ui-metric-card>
        </div>
    </ng-container>
</div>

